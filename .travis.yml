language:
  java

jdk:
  openjdk8

dist:
  xenial

services:
  postgresql

addons:
  postgresql: '13'
  apt:
    packages:
      - postgresql-13
      - postgresql-client-13

before_install:
  - sudo apt-get update
  - sudo apt-get --yes remove postgresql\*
  - sudo apt-get install -y postgresql-13 postgresql-client-13
  - sudo cp /etc/postgresql/{9.6,13}/main/pg_hba.conf
  - sudo service postgresql restart 13

script:
  - mvn clean install

before_script:
  - psql -c 'create database perfumetest;' -U postgres -p 5433
  - psql -c 'create database perfume;' -U postgres -p 5433

after_success:
  - bash <(curl -s https://codecov.io/bash)

env:
  global:
    - PGPORT=5433
    - CODECOV_TOKEN="dfdd0733-79b6-4ba4-8076-4093fda24b15"
  jobs:
    - DB_PORT=5433 DB_USERNAME=postgres
